/**
 * Mesour Editable Component - mesour.editable.min.js
 * @author Matous Nemec (http://mesour.com)
 */
/** Mesour Popover JS - src/popover/mesour.popover.js */
var mesour=!mesour?{}:mesour;mesour.popover=!mesour.popover?{}:mesour.popover;(function($){var e=function(){var d=this;this.create=function(a,b){a.popover(!b?{}:b)};this.show=function(a,b,c){if(typeof b==='function'){if(c){a.on('shown.bs.popover',b)}else{a.off('shown.bs.popover.non-persist');a.on('shown.bs.popover.non-persist',b)}}a.popover('show')};this.hide=function(a){a.popover('hide')};this.destroy=function(a){a.popover('destroy')};this.getTip=function(a){return a.data('bs.popover').$tip}};mesour.core.createWidget('popover',new e())})(jQuery);
/** Mesour Editable JS */
var mesour=!mesour?{}:mesour;mesour._editable=!mesour._editable?{}:mesour._editable;mesour._editable.fields=!mesour._editable.fields?{}:mesour._editable.fields;
/* src/mesour.editable.field.Text.js */
(function($){mesour._editable.fields.Text=function(a,b,c,d,f,g){this.TYPE=b.TYPE_TEXT;d=d||{};var h=this,fieldName=a['name'],hasTextarea=!g?(a['hasTextarea']==='false'?false:true):false,oldValue=$.trim(c.text()),input,hasSoftReset=true,reset=function(){};if(hasTextarea){input=$('<textarea type="text" class="form-control" name="'+fieldName+'"></textarea>');input.text(oldValue);hasSoftReset=false}else{input=$('<input type="text" value="'+oldValue+'" class="form-control" name="'+fieldName+'">');input.on('keydown.mesour-editable',function(e){if(e.keyCode===13){b.save(fieldName,f)}else if(e.keyCode===27){reset()}})}var i=new mesour._editable.EditablePopover(b,c,input,h,hasSoftReset),reset=function(){i.destroy()};if(hasTextarea){input.on('keydown',b.textareaTabFix)}input.css('width','100%');i.onSave(function(){b.save(fieldName,f)});i.onReset(function(){reset()});input.focus();this.getInput=function(){return input};this.getEditablePopover=function(){return i};this.getElement=function(){return c};this.getValue=function(){return{oldValue:oldValue,value:input.val(),params:d}};this.reset=function(){reset()};this.save=function(){i.destroy();c.empty().text(input.val())}}})(jQuery);
/* src/mesour.editable.field.Enum.js */
(function($){mesour._editable.fields.Enum=function(a,b,c,d,f,g,h,j){this.TYPE=b.TYPE_ENUM;d=d||{};var k=this,oldValue=c.text(),fieldName=a['name'],h=h?h:a['values'],isNullable=a['nullable'],removeRow=typeof d['remove_row']!=='undefined'?(!d['remove_row']?false:true):null,select=$('<select class="form-control"></select>'),popover=new mesour._editable.EditablePopover(b,c,select,k);select.css('width','100%');for(var i in h){if(!h.hasOwnProperty(i)){continue}var l=$('<option>').attr('value',h[i]['key']).text(h[i]['name']);if(h[i]['key']==g){l.prop('selected',true)}select.append(l)}if(isNullable&&!j){select.prepend('<option value="">'+b.getEditableWidget().getTranslate('emptyValue')+'</option>')}select.on('keydown.mesour-editable',function(e){if(e.keyCode===27){k.reset()}});popover.onSave(function(){b.save(fieldName,f)});popover.onReset(function(){k.reset()});this.getEditablePopover=function(){return popover};this.getElement=function(){return c};this.getSelect=function(){return select};this.getValue=function(){return{oldValue:g,value:select.find(':selected').val(),params:d}};this.reset=function(){popover.destroy()};this.save=function(){popover.destroy();c.empty().text(select.find(':selected').text())}}})(jQuery);
/* src/mesour.editable.field.Number.js */
mesour._editable.numberFormat=function(b,c,d,e){b=(b+'').replace(/[^0-9+\-Ee.]/g,'');var n=!isFinite(+b)?0:+b,prec=!isFinite(+c)?0:Math.abs(c),sep=(typeof e==='undefined')?',':e,dec=(typeof d==='undefined')?'.':d,s='',toFixedFix=function(n,a){var k=Math.pow(10,a);return''+(Math.round(n*k)/k).toFixed(a)};s=(prec?toFixedFix(n,prec):''+Math.round(n)).split('.');if(s[0].length>3){s[0]=s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,sep)}if((s[1]||'').length<prec){s[1]=s[1]||'';s[1]+=new Array(prec-s[1].length+1).join('0')}return s.join(dec)};mesour._editable.isNumeric=function(a){var b=" \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000";return(typeof a==='number'||(typeof a==='string'&&b.indexOf(a.slice(-1))===-1))&&a!==''&&!isNaN(a)};(function($){var k=mesour._editable.isNumeric;var l=mesour._editable.numberFormat;mesour._editable.fields.Number=function(c,d,f,g,h){this.TYPE=d.TYPE_NUMBER;g=g||{};var i=new mesour._editable.fields.Text(c,d,f,g,h,true);var j=this,fieldName=c['name'],unit=c['unit'],separator=c['separator'],decimalPoint=c['decimalPoint'],decimals=c['decimals'],isNullable=c['nullable'],input=i.getInput(),popover=i.getEditablePopover();function fixNumber(a){var b=$.trim(a.replace(new RegExp(separator==='.'?'\\.':separator,'g'),'').replace(decimalPoint,'.').replace(unit,''));if(!mesour._editable.isNumeric(b)){return''}return b};function save(){var a=mesour._editable.Validators.validateNumber(d,input.val(),input,true,isNullable,j);if(a){d.save(fieldName,h)}};input.val(fixNumber(input.val()));input.attr('placeholder',mesour._editable.numberFormat(0,decimals));if(unit){input.after('<span style="" class="input-group-addon">'+unit+'</span>')}input.focus();popover.onSave(function(){save()});input.off('keydown.mesour-editable');input.on('keydown.mesour-editable',function(e){if(e.keyCode===13){save()}else if(e.keyCode===27){i.reset()}});this.getElement=function(){return f};this.getValue=function(){var a=i.getValue();a['oldValue']=fixNumber(a['oldValue']);return a};this.reset=function(){i.reset()};this.save=function(){var a=input.val();f.empty().text(l(a,decimals,decimalPoint,separator)+(unit?(' '+unit):''));popover.destroy()}}})(jQuery);
/* src/mesour.editable.field.Date.js */
(function($){mesour._editable.fields.Date=function(b,c,d,e,f,g){this.TYPE=c.TYPE_DATE;e=e||{};var h=new mesour._editable.fields.Text(b,c,d,e,f,true);var i=this,fieldName=b['name'],format=b['format'],input=h.getInput();d.parent().css('position','relative');var j=g;input.val(!j||j==='-'?'':j);input.attr('data-is-date','true');input.attr('placeholder',format);mesour.dateTimePicker.create(input,format,true);mesour.dateTimePicker.show(input);this.getElement=function(){return d};this.getValue=function(){var a=h.getValue();a['oldValue']=j;return a};this.reset=function(){mesour.dateTimePicker.destroy(input);h.reset()};this.save=function(){mesour.dateTimePicker.destroy(input);h.save()}}})(jQuery);
/* src/mesour.editable.field.Bool.js */
(function($){mesour._editable.fields.Bool=function(a,b,c,d,f,g){this.TYPE=b.TYPE_TEXT;d=d||{};var h=this,fieldName=a['name'],description=a['description'],nullable=a['nullable'],oldValue=c.text(),prependButtons=[],input=$('<input type="checkbox" value="1" id="editable-bool">'),label=$('<label for="editable-bool">'),getInputValue=function(){return input.is(':checked')};if(nullable){var i=$('<button class="btn btn-warning" title="'+b.getEditableWidget().getTranslate('emptyButton')+'"><i class="fa fa-ban"></i></button>');prependButtons=[i];i.on('click',function(e){e.preventDefault();if(confirm(b.getEditableWidget().getTranslate('saveEmptyValue'))){getInputValue=function(){return''};input.prop('checked',false);b.save(fieldName,f)}})}var j=new mesour._editable.EditablePopover(b,c,input,h,false,prependButtons),reset=function(){j.destroy()};j.onSave(function(e){b.save(fieldName,f)});j.onReset(function(e){reset()});if(g==1||g==='true'||g===true){input.prop('checked',true)}input.wrap(label);input.after(' '+description);this.getElement=function(){return c};this.getInput=function(){return input};this.getValue=function(){return{oldValue:g,value:getInputValue(),params:d}};this.reset=function(){reset()};this.save=function(){j.destroy()}}})(jQuery);
/* src/mesour.editable.field.OneToOne.js */
(function($){mesour._editable.fields.OneToOne=function(h,j,k,l,m,n){this.TYPE=j.TYPE_ONE_TO_ONE;l=l||{};var o=this,select,oldValue=k.text(),title=h['title'],reference=h['reference'],table=reference['table'],primaryKey=reference['primary_key'],column=reference['column'],fieldName=h['name'],createNewRow=l['create_new_row'];function getDefaultValues(a,b){b=!b?{}:b;a=!a?{}:a;var c=null;if(b['id']){c={id:b['id']}}return{oldValues:a,newValues:b,params:l,values:c}};j.getEditableWidget().getReferenceData(j.getName(),table,function(b){b=b.data?b.data:b;var c={},hiddenValues={};for(var i in b){if(!b.hasOwnProperty(i)){continue}if(b[i][primaryKey]==n){c=b[i];hiddenValues[column]=b[i][column];break}}j.getModal().show();j.getModal().setTitle(title);var d=j.getElementStructure(table);var f=j.getModal().createForm(d.fields?d.fields:d);j.getModal().fillForm(f,c,hiddenValues);j.getModal().addHiddenField(f,'__fieldName',fieldName);if(m){j.getModal().addHiddenField(f,'__identifier',m);if(n){var g=j.getModal().addHiddenField(f,primaryKey,n);g.attr('data-editable-in-data','true')}}j.getModal().onSubmit(m,function(e,a){o.getValue=function(){return getDefaultValues(c,j.getModal().getFormValues(f))};if(n){j.editForm(fieldName,a,f,table)}else{j.create(fieldName,m,f,table)}o.getValue=function(){return getDefaultValues(c)}})});this.getElement=function(){return k};this.getValue=function(){return getDefaultValues()};this.reset=function(){};this.save=function(){}}})(jQuery);
/* src/mesour.editable.field.ManyToOne.js */
(function($){mesour._editable.fields.ManyToOne=function(l,m,n,o,p,q,r){this.TYPE=m.TYPE_MANY_TO_ONE;o=o||{};var s=this,select,oldValue=n.text(),title=l['title'],reference=l['reference'],table=reference['table'],primaryKey=reference['primary_key'],column=reference['column'],editButton=$('<button class="btn btn-info" title="'+m.getEditableWidget().getTranslate('editItem')+'"><i class="fa fa-pencil"></i></button>'),pattern=reference['pattern'],fieldName=l['name'],createNewRow=o['create_new_row'],editCurrentRow=o['edit_current_row'];var t;m.getEditableWidget().getReferenceData(m.getName(),table,function(g){g=g.data?g.data:g;var h={};if(createNewRow){h[0]={key:'__add_new_record__',name:'+ Add new record'}}var j=null;for(var i in g){if(!g.hasOwnProperty(i)){continue}if(g[i][primaryKey]==q){j=g[i]}h[g[i][primaryKey]]={key:g[i][primaryKey],name:pattern?mesour.core.parseValue(pattern,g[i]):g[i][primaryKey]}}select=new mesour._editable.fields.Enum(l,m,n,o,p,q,h);t=select.getEditablePopover();if(editCurrentRow){t.addButton(editButton)}var k=function(c){t.hide();m.getModal().show();m.getModal().setTitle(title);var d=m.getElementStructure(table);var f=m.getModal().createForm(d.fields?d.fields:d);if(c){if(!j){throw new Error('Item not found.');}m.getModal().addHiddenField(f,'id',p,true);m.getModal().fillForm(f,j)}m.getModal().addHiddenField(f,'__fieldName',fieldName);m.getModal().addHiddenField(f,'__identifier',p);m.getModal().onSubmit(p,function(e,b){s.getValue=function(){var a=select.getValue();a['newValues']=m.getModal().getFormValues(f);if(!j){a['oldValues']={};a['oldValues'][primaryKey]=q}else{a['oldValues']=j}return a};if(c){m.editForm(fieldName,b,f,table)}else{m.create(fieldName,b,f,table)}s.getValue=function(){return select.getValue()}})};select.getSelect().on('change',function(){var a=$(this);if(a.val()==='__add_new_record__'){k()}});if(r){k(true)}editButton.on('click',function(e){e.preventDefault();m.close(fieldName,p,true);m.edit(fieldName,n,p,q,true)});t.onSave(function(){var a=$(this).closest('.input-group').find(':input:first');if(a.val()==='__add_new_record__'){k()}else{m.save(fieldName,p)}})});this.getElement=function(){return n};this.getValue=function(){return select.getValue()};this.reset=function(){t.destroy();select.reset()};this.save=function(){select.save()}}})(jQuery);
/* src/mesour.editable.field.OneToMany.js */
(function($){mesour._editable.fields.OneToMany=function(h,j,k,l,m,n){this.TYPE=j.TYPE_ONE_TO_MANY;l=l||{};var o=this,select,oldText=k.text(),oldValue=k.attr('data-value'),title=h['title'],reference=h['reference'],table=reference['table'],primaryKey=reference['primary_key'],column=reference['column'],pattern=reference['pattern'],fieldName=h['name'],createNewRow=l['create_new_row'];function getDefaultValues(a,b){b=!b?{}:b;a=!a?{}:a;var c=null;if(b['id']){c={id:b['id']}}return{oldValues:a,newValues:b,params:l,values:c}}j.getEditableWidget().getReferenceData(j.getName(),table,function(b){b=b.data?b.data:b;var c={},hiddenValues={};for(var i in b){if(!b.hasOwnProperty(i)){continue}if(b[i][primaryKey]==n){c=b[i];hiddenValues[column]=b[i][column];break}}j.getModal().show();j.getModal().setTitle(title);var d=j.getElementStructure(table);var f=j.getModal().createForm(d.fields?d.fields:d);j.getModal().fillForm(f,c,hiddenValues);j.getModal().addHiddenField(f,'__fieldName',fieldName);if(m){j.getModal().addHiddenField(f,'__identifier',m);if(n){var g=j.getModal().addHiddenField(f,primaryKey,n);g.attr('data-editable-in-data','true')}}j.getModal().onSubmit(m,function(e,a){o.getValue=function(){return getDefaultValues(c,j.getModal().getFormValues(f))};if(n){j.editForm(fieldName,a,f,table)}else{j.create(fieldName,m,f,table)}o.getValue=function(){return getDefaultValues(c)}})});this.getElement=function(){return k};this.getValue=function(){return getDefaultValues()};this.reset=function(){};this.save=function(){}}})(jQuery);
/* src/mesour.editable.field.ManyToMany.js */
(function($){mesour._editable.fields.ManyToMany=function(w,x,y,z,A,B){this.TYPE=x.TYPE_MANY_TO_MANY;z=z||{};var C=this,select,oldText=y.text(),oldValue=y.attr('data-value'),title=w['title'],reference=w['reference'],table=reference['table'],referencedTable=reference['referenced_table'],primaryKey=reference['primary_key'],column=reference['column'],selfColumn=reference['self_column'],pattern=reference['pattern'],fieldName=w['name'],attachNewRow=z['attach_row'],createNewRow=z['create_new_row'];function getDefaultValues(a,b,c,d,e){b=!b?{}:b;for(var j in b){if(!b.hasOwnProperty(j)){continue}b[j]=typeof b[j]==='null'||typeof b[j]==='undefinded'?'':b[j]}a=!a?{}:a;var f={reference:{'selfColumn':{name:selfColumn,value:c},'column':{name:column,value:d}},params:z};if(e){return f}f['oldValues']=a;f['newValues']=b;return f}x.getEditableWidget().getReferenceData(x.getName(),table,function(g){var h=g.reference?g.reference:[];g=g.data?g.data:g;var l={};if(B){var m=[];for(var j in h){if(!h.hasOwnProperty(j)){continue}if(h[j][column]==A){m.push(h[j][primaryKey])}}if(!m.length){throw new Error('Referenced id not found.');}}var n=null;if(B){var n=B}for(var i in g){if(!g.hasOwnProperty(i)){continue}if(g[i][primaryKey]==n){l=g[i];break}}x.getModal().show();x.getModal().setTitle(title);var o=x.getElementStructure(table);var p=x.getModal().createForm(o.fields?o.fields:o);if(typeof B==='undefined'&&attachNewRow&&createNewRow){p.find('[data-mesour-has-toggle="new"]').prepend('<h3>'+x.getEditableWidget().getTranslate('createNew')+'</h3>')}x.getModal().fillForm(p,l);x.getModal().addHiddenField(p,'__fieldName',fieldName);if(A){x.getModal().addHiddenField(p,'__identifier',A);if(B){var q=x.getModal().addHiddenField(p,primaryKey,B);q.attr('data-editable-in-data','true')}}if(typeof B==='undefined'&&attachNewRow){var r=x.getModal().appendToggleForm(p,'old');var s=$('<div class="form-group"><h3>'+x.getEditableWidget().getTranslate('selectExisting')+'</h3></div>');var t=$('<select class="form-control" name="'+selfColumn+'">');var u=[];for(var j in h){if(!h.hasOwnProperty(j)){continue}if(h[j][column]==A){u.push(h[j][selfColumn])}}var v=[];for(var i in g){if(!g.hasOwnProperty(i)){continue}if(u.indexOf(g[i][primaryKey])===-1){v.push(g[i])}}if(v.length>0){t.append('<option value="">'+x.getEditableWidget().getTranslate('select')+'</option>');for(var k=0;k<v.length;k++){t.append('<option value="'+v[k][primaryKey]+'">'+v[k]['name']+'</option>')}}else{t.append('<option>'+x.getEditableWidget().getTranslate('allSelected')+'</option>')}s.append(t);r.append(s)}if(!createNewRow){p.find('.main-form-group:first').hide()}x.getModal().onSubmit(A,function(e,d){var f=p.find('[name="__type_selector"]');C.getValue=function(){if(f.is('*')&&f.val()==='old'){var a=x.getModal().getFormValues(p);var b=a[selfColumn];delete a[selfColumn];var c=getDefaultValues(l,a,b,d,true);return c}else{return getDefaultValues(l,x.getModal().getFormValues(p),B,d)}};if(f.is('*')&&f.val()==='old'){x.attach(fieldName,d,p,table)}else if(typeof B!=='undefined'){x.editForm(fieldName,d,p,table)}else{x.create(fieldName,A,p,table)}C.getValue=function(){return getDefaultValues(l)}})},referencedTable);this.getElement=function(){return y};this.getValue=function(){return getDefaultValues()};this.reset=function(){};this.save=function(){}}})(jQuery);
/* src/mesour.editable.Validators.js */
(function($){mesour._editable.Validators={validateNumber:function(a,b,c,d,e,f){var g=mesour._editable.isNumeric(b.replace(',','.'));if((!e&&!b)||(e&&b&&!g)){if(!d){c.closest('form').find('.main-form-group:visible:first').prepend(a.createAlert(a.getEditableWidget().getTranslate('invalidNumber'),'danger'))}else{var h=$('.editable-popover:visible .popover-content');h.find('.mesour-editable-alert').remove();mesour.popover.show(f.getElement(),function(){h.prepend(a.createAlert(a.getEditableWidget().getTranslate('invalidNumber'),'danger',false))})}if(c){var i=c.closest('.form-group');if(!i.is('*')){i=c.closest('.input-group')}i.addClass('has-error');c.trigger('focus')}return false}return true}}})(jQuery);
/* src/mesour.editable.FieldEditor.js */
(function($){mesour._editable.FieldEditor=function(a,b,c,d,e,f){var g=b['name'],type=b['type'],parameters=b['params'],field;if(d){parameters=parameters[d]}if(type===a.TYPE_TEXT){field=new mesour._editable.fields.Text(b,a,c,parameters,d)}else if(type===a.TYPE_NUMBER){field=new mesour._editable.fields.Number(b,a,c,parameters,d)}else if(type===a.TYPE_DATE){field=new mesour._editable.fields.Date(b,a,c,parameters,d,e)}else if(type===a.TYPE_ENUM){field=new mesour._editable.fields.Enum(b,a,c,parameters,d,e)}else if(type===a.TYPE_BOOL){field=new mesour._editable.fields.Bool(b,a,c,parameters,d,e)}else if(type===a.TYPE_ONE_TO_ONE){field=new mesour._editable.fields.OneToOne(b,a,c,parameters,d,e)}else if(type===a.TYPE_MANY_TO_ONE){field=new mesour._editable.fields.ManyToOne(b,a,c,parameters,d,e,f)}else if(type===a.TYPE_ONE_TO_MANY){field=new mesour._editable.fields.OneToMany(b,a,c,parameters,d,e)}else if(type===a.TYPE_MANY_TO_MANY){field=new mesour._editable.fields.ManyToMany(b,a,c,parameters,d,e)}else{throw new Error('Unknown field type '+type);}this.getField=function(){return field.getElement()};this.getValues=function(){return field.getValue()};this.resetValue=function(){return field.reset()};this.saveValue=function(){return field.save()}}})(jQuery);
/* src/mesour.editable.Editable.js */
(function($){mesour._editable.Editable=function(n,o,p){var q=new mesour._editable.EditableModal(n,this),inline=false,disabledInlineAlerts=false,onComplete=function(){};var s=o.fields||[];elements=o.elements||{};this.TYPE_TEXT='text';this.TYPE_NUMBER='number';this.TYPE_DATE='date';this.TYPE_ENUM='enum';this.TYPE_BOOL='bool';this.TYPE_ONE_TO_ONE='one_to_one';this.TYPE_MANY_TO_ONE='many_to_one';this.TYPE_ONE_TO_MANY='one_to_many';this.TYPE_MANY_TO_MANY='many_to_many';var t=this,openedEdits={};this.setInline=function(a){inline=a==="true"?true:false};this.isInline=function(){return inline};this.setDisabledInlineAlerts=function(a){disabledInlineAlerts=a==="true"?true:false};this.isDisabledInlineAlerts=function(){return disabledInlineAlerts};this.createAlert=function(a,b,c){b=!b?'danger':b;var d=$('<div class="alert alert-'+b+' mesour-editable-alert">'+a+'</div>');if(typeof c==='undefined'||c){d.prepend('<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span></button>')}return d};function getFieldStructure(a,b){b=typeof b==='undefined'?true:b;for(var i=0;i<s.length;i++){if(s[i]['name']===a){return s[i]}}if(b){throw new Error('No structure for field with name '+a);}else{return null}};this.getFieldStructure=getFieldStructure;this.textareaTabFix=function(e){if(e.keyCode===9){var a=this.selectionStart;var b=this.selectionEnd;var c=$(this);var d=c.val();c.val(d.substring(0,a)+"\t"+d.substring(b));this.selectionStart=this.selectionEnd=a+1;e.preventDefault()}};function removeEditedField(a,b){if(!openedEdits[a]){return}if(b){delete openedEdits[a][b]}else{delete openedEdits[a]}};function getEditedField(a,b,c){c=typeof c==="undefined"?true:c;if(c&&!openedEdits[a]){throw new Error('Field with name '+a+' is not edited');}if(!openedEdits[a])return null;if(b){if(c&&!openedEdits[a][b]){throw new Error('Field with name '+a+' and identifier '+b+' is not edited');}return openedEdits[a][b]}else{if(c&&!openedEdits[a]){throw new Error('Field with name '+a+' is not edited');}return openedEdits[a]}};function editField(a,b,c,d,e){var f=a['name'];for(var i in openedEdits){if(!openedEdits.hasOwnProperty(i)){continue}if(openedEdits[i]instanceof mesour._editable.FieldEditor){openedEdits[i].resetValue();delete openedEdits[i]}else{for(var j in openedEdits[i]){if(!openedEdits[i].hasOwnProperty(j)){continue}openedEdits[i][j].resetValue();delete openedEdits[i][j]}}}q.enable();if(c){openedEdits[f]=openedEdits[f]||{};openedEdits[f][c]=new mesour._editable.FieldEditor(t,a,b,c,d,e)}else{openedEdits[f]=new mesour._editable.FieldEditor(t,a,b,c,d,e)}};this.getElementStructure=function(a){if(!elements[a]){throw new Error('Element with table name '+a+' not exist.');}return elements[a]};this.getEditableWidget=function(){return p};this.setOnCompleteCallback=function(a){if(typeof a!=='function'){throw new Error('Callback must be function.');}onComplete=a};this.getModal=function(){return q};this.getName=function(){return n};this.close=function(a,b,c){var d=getEditedField(a,b,false);if(d){d.resetValue()}if(c){removeEditedField(a,b)}};function postCallback(a,b,c,d,f,g,h){try{var i=$.parseJSON(f.responseText);if(i.error){if(h){var j=t.createAlert(i.error.message,'danger',false),l;if(!t.isInline()){var k=mesour.popover.getTip(d.getField()).find('.popover-content');k.find('.mesour-editable-alert').remove();mesour.popover.show(d.getField(),function(){k.prepend(j)});l=k.find('[name="'+i.error.field+'"]')}else{if(!t.isDisabledInlineAlerts()){d.getField().find('.mesour-editable-alert').remove();d.getField().prepend(j)}l=d.getField().find('[name="'+i.error.field+'"]')}if(i.error.field){l.closest('.input-group').addClass('has-error');l.trigger('focus')}}else{a.find('.mesour-editable-alert').remove();a.prepend(t.createAlert(i.error.message));if(i.error.field){var l=a.find('[name="'+i.error.field+'"]');l.closest('.form-group').addClass('has-error');l.trigger('focus')}}}}catch(e){if(f.status===200){if(d){d.saveValue();removeEditedField(b,g)}mesour.core.redrawCallback(f);if(!h){mesour.editable.removeReference(n,c);q.getModalBody().empty().append(t.createAlert(p.getTranslate('dataSaved'),'success',false));q.disable()}onComplete(b)}else{var m=p.getTranslate('statusError').replace('%status%',f.status);if(h){alert(m)}else{a.find('.mesour-editable-alert').remove();a.prepend(t.createAlert(m,'danger'))}}}};this.remove=function(a,b,c,d){var e=mesour.core.createLink(n,'remove',postData={name:a,identifier:c,value:d},true);$.post(e[0],e[1]).complete(function(r){postCallback(null,a,null,null,r,c,true)});p.removeReference(n)};this.newEntry=function(a,b,c){if(!b){throw new Error('Element for edit is required.');}var d=getFieldStructure(a);editField(d,b,c)};this.edit=function(a,b,c,d,e){if(!b){throw new Error('Element for edit is required.');}var f=getFieldStructure(a);var g=getEditedField(a,c,false);editField(f,b,c,d,e)};this.save=function(a,b){var c=getEditedField(a,b);var d=c.getValues(),postData={name:a,identifier:b,params:d['params'],newValue:d['value'],oldValue:d['oldValue']};var e=mesour.core.createLink(n,'edit',postData,true);$.post(e[0],e[1]).complete(function(r){postCallback(null,a,null,c,r,b,true)})};this.editForm=function(a,b,c,d){var e=getEditedField(a,b);var f=e.getValues(),postData={name:a,identifier:b,params:f['params'],values:f['newValues'],oldValues:f['oldValues']};if(f['reference']){postData['reference']=f['reference']}var g=mesour.core.createLink(n,'editForm',postData,true);$.post(g[0],g[1]).complete(function(r){postCallback(c,a,d,e,r,b)})};this.attach=function(a,b,c,d){var e=getEditedField(a,b);var f=e.getValues(),postData={name:a,identifier:b,params:f['params'],reference:f['reference']};var g=mesour.core.createLink(n,'attach',postData,true);$.post(g[0],g[1]).complete(function(r){postCallback(c,a,d,e,r,b)})};this.create=function(a,b,c,d){var e=getEditedField(a,b);var f=e.getValues(),postData={name:a,params:f['params'],identifier:b,references:f['values'],values:t.getModal().getFormValues(c)};var g=mesour.core.createLink(n,'create',postData,true);$.post(g[0],g[1]).complete(function(r){postCallback(c,a,d,e,r)})}}})(jQuery);
/* src/mesour.editable.EditableModal.js */
(function($){mesour._editable.EditableModal=function(l,m){var n=this,element=$('[data-editable-modal="'+l+'"]'),modalName=element.attr('data-mesour-modal');function toogle(){var a=$(this),group=a.attr('data-mesour-toggle'),others=a.closest('[data-mesour-toggle-group]').find('[data-mesour-toggle]').not(a);element.find('.has-error').removeClass('has-error');element.find('.alert').remove();if(!a.hasClass('active')){others.removeClass('active');a.addClass('active');element.find('input[name="__type_selector"]').val(group);element.find('[data-mesour-has-toggle]').hide();element.find('[data-mesour-has-toggle="'+group+'"]').show()}};function addTextField(b,c,d,f,g){var h=$('<label for="'+c+'">'+d+'</label>');b.append(h);var i=$('<input type="text" class="form-control" id="'+c+'" name="'+f+'">');if(g){i.attr('placeholder',g)}b.append(i);i.on('keydown',function(e){if(e.keyCode===13){e.preventDefault();var a=element.find('[data-editable-form-save]');a.trigger('click')}});return i};function addTextarea(a,b,c,d,e){var f=$('<label for="'+b+'">'+c+'</label>');a.append(f);var g=$('<textarea type="text" class="form-control" id="'+b+'" name="'+d+'">');if(e){g.attr('placeholder',e)}a.append(g);g.on('keydown',m.textareaTabFix);return g};function addCheckboxField(a,b,c,d){var e=$('<label for="'+b+'"> '+c+'</label>');a.append(e);var f=$('<input type="checkbox" id="'+b+'" name="'+d+'">');e.prepend(f);a.append(e);return f};function addGroupToForm(a,b){b=!b?'form-group':b;var c=$('<div class="'+b+'">');a.append(c);return c};function createTogglesGroup(){var a=$('<div class="main-form-group">');var b=addGroupToForm(a);b.append('<label for="__type_selector">'+m.getEditableWidget().getTranslate('selectOne')+'</label>');var c=$('<div class="btn-group" role="group" aria-label="__type_selector" data-mesour-toggle-group="true">');var d=$('<button type="button" class="btn btn-info" data-mesour-toggle="old">'+m.getEditableWidget().getTranslate('attachExisting')+'</button>');var e=$('<button type="button" class="btn btn-info" data-mesour-toggle="new">'+m.getEditableWidget().getTranslate('createNew')+'</button>');d.on('click.mesour-editable-toggle',toogle);e.on('click.mesour-editable-toggle',toogle);c.append(d);c.append(e);d.trigger('click.mesour-editable-toggle');a.append($(c));return a};function createForm(b){var c=$('<form><div class="main-form-group" data-mesour-has-toggle="new">');function addFormGroup(a){return addGroupToForm(c.children('div[data-mesour-has-toggle="new"]'),a)};for(var i in b){if(!b.hasOwnProperty(i)){continue}var d=b[i];if(d['type']===m.TYPE_TEXT){var e,args=[addFormGroup(),l+d['name'],d['title'],d['name'],d['title']];if(d['hasTextarea']==='false'){e=addTextField.apply(n,args)}else if(d['hasTextarea']==='true'){e=addTextarea.apply(n,args)}}else if(d['type']===m.TYPE_BOOL){var e=addCheckboxField(addFormGroup('checkbox'),l+d['name'],d['title'],d['name'])}else if(d['type']===m.TYPE_NUMBER){var e=addTextField(addFormGroup(),l+d['name'],d['title'],d['name'],mesour._editable.numberFormat(0,d['decimals']));e.attr('data-validate-number','true');e.attr('data-nullable',d['nullable']?'true':'false');if(d['unit']){e.wrap('<div class="input-group">');e.after($('<span style="text-align:right;"  class="input-group-addon">'+d['unit']+'</span>'))}}else if(d['type']===m.TYPE_ENUM){var f=addFormGroup(),id=l+d['name'];var g=$('<label for="'+id+'">'+d['title']+'</label>');f.append(g);var h=$('<select class="form-control" id="'+id+'" placeholder="'+d['title']+'" name="'+d['name']+'">');if(d['nullable']){h.prepend('<option value="">'+m.getEditableWidget().getTranslate('emptyValue')+'</option>')}for(var j in d['values']){if(!d['values'].hasOwnProperty(j)){continue}var k=d['values'][j];h.append('<option value="'+k['key']+'">'+k['name']+'</option>')}f.append(h)}else if(d['type']===m.TYPE_DATE){var e=addTextField(addFormGroup(),l+d['name'],d['title'],d['name'],d['format']);mesour.dateTimePicker.create(e,d['format'])}}return c};this.getName=function(){return modalName};this.show=function(){mesour.modal.show(modalName);mesour.modal.onHide(modalName,function(){var a=element.find('form');m.close(a.find('[name="__fieldName"]').val(),a.find('[name="__identifier"]').val())})};this.setTitle=function(a){var b=element.find('.modal-header'),titleSpan=b.find('.modal-title');if(!titleSpan.is('*')){titleSpan=$('<h4 class="modal-title">');b.append(titleSpan)}titleSpan.empty().text(a)};this.hide=function(){mesour.modal.hide(modalName)};this.onSubmit=function(d,f){var g=function(e){e.preventDefault();var a=element.find('form'),values=n.getFormValues(a);if(d!=a.find('[name="__identifier"]').val()){return}a.find('.has-error').removeClass('has-error');a.find('.alert').remove();var b=true;for(var i in values){if(!values.hasOwnProperty(i)){continue}var c=a.find('[name="'+i+'"]');if(c.attr('data-validate-number')&&c.closest('.main-form-group').is(':visible')&&!mesour._editable.Validators.validateNumber(m,values[i],c,false,c.attr('data-nullable')==='true'?true:false)){b=false}}if(b){f(e,a.find('[name="__identifier"]').val())}};n.refresh=function(){var a=element.find('[data-editable-form-save]');a.off('click.mesour-editable');a.on('click.mesour-editable',g)};n.refresh()};this.getModalBody=function(){return mesour.modal.getBody(modalName)};this.disable=function(){element.find('[data-editable-form-save]').hide()};this.enable=function(){element.find('[data-editable-form-save]').show()};this.createForm=function(a){var b=n.getModalBody(),form=createForm(a);b.empty();b.append(form);return form};this.appendToggleForm=function(a,b){n.addHiddenField(a,'__type_selector',b);var c=$('<div class="main-form-group" data-mesour-has-toggle="'+b+'">');a.append(c);a.prepend(createTogglesGroup());return c};this.addHiddenField=function(a,b,c,d){var e=a.find('input[name="'+b+'"]');if(!e.is('*')){e=$('<input type="hidden" name="'+b+'" value="'+c+'">');a.append(e)}else{e.val(c)}if(d){e.attr('data-editable-in-data',true)}return e};this.getFormValues=function(b){var c={};b.find('input[type=text], select, [data-editable-in-data], textarea').each(function(){var a=$(this);c[a.attr('name')]=a.val()});b.find('input[type=checkbox]').each(function(){var a=$(this);c[a.attr('name')]=a.is(':checked')?true:false});return c};this.fillForm=function(a,b,c){for(var d in b){if(!b.hasOwnProperty(d)){continue}var e=a.find('input[name="'+d+'"], select[name="'+d+'"], textarea[name="'+d+'"]');if(e.is('*')){if(e.is('input[type=checkbox]')&&b[d]){e.prop('checked',true)}else{e.val(b[d])}}}for(var d in c){if(!c.hasOwnProperty(d)){continue}var f=n.addHiddenField(a,d,c[d]);f.attr('data-editable-in-data','true')}}}})(jQuery);
/* src/mesour.editable.EditablePopover.js */
(function($){mesour._editable.EditablePopover=function(b,c,d,f,g,h){h=h||{};var j=this,onSaveCallback,onResetCallback;var k=$('<div class="input-group input-group-sm">');k.append(d);if(b.isInline()){k.addClass('editable-inline')}var l=$('<span class="input-group-btn"></span>');for(var i in h){if(!h.hasOwnProperty(i)){continue}l.append(h[i])}var m=$('<button class="btn btn-primary" title="'+b.getEditableWidget().getTranslate('saveItem')+'"><i class="fa fa-check"></i></button>');l.append(m);var n=$('<button class="btn btn-default" title="'+b.getEditableWidget().getTranslate('cancelEdit')+'"><i class="fa fa-remove"></i></button>');l.append(n);d.after(l);this.addButton=function(a){l.prepend(a)};if(g&&!b.isInline()){var o=$('<i class="fa fa-times-circle editable-soft-reset" title="'+b.getEditableWidget().getTranslate('reset')+'"></i>');if(!d.val()){o.hide()}d.after(o);o.on('click',function(){d.val(null);o.hide();if(d.attr('data-is-date')!=='true'){d.focus()}});var p=function(e){if($(this).val().length>0){o.show()}else{o.hide()}};d.on('propertychange change click keyup input paste blur',p)}if(!b.isInline()){mesour.popover.create(c,{content:function(){return k},html:true,container:'body',placement:'auto',trigger:'manual',template:'<div class="popover editable-popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"><form class="form-inline"></form></div></div>'});mesour.popover.show(c,function(){if(g){o.css('left',d.width())}},true)}else{var q=c.contents().clone();c.empty().append(k)}this.onSave=function(a){onSaveCallback=a};this.onReset=function(a){onResetCallback=a};this.hide=function(){if(!b.isInline()){mesour.popover.hide(c)}else{c.empty().append(q)}};this.destroy=function(){if(!b.isInline()){mesour.popover.destroy(c)}else{c.empty().append(q)}};m.on('click',function(e){e.preventDefault();if(typeof onSaveCallback==='function'){onSaveCallback.apply(this,[e])}});n.on('click',function(e){e.preventDefault();if(typeof onResetCallback==='function'){onResetCallback.apply(this,[e])}})}})(jQuery);
/* src/mesour.editable.core.js */
var mesour=!mesour?{}:mesour;mesour.editable=!mesour.editable?{}:mesour.editable;(function($){var m=function(i){var j=this;this.items={};var k={};var l={select:'Select...',selectOne:'Select one',selectExisting:'Select from existing',allSelected:'All existing companies are attachet to this client...',attachExisting:'Attach existing',createNew:'Create new',reset:'Reset value',emptyButton:'Set empty value',saveItem:'Save',editItem:'Edit in form',cancelEdit:'Cancel',dataSaved:'Successfuly saved',saveEmptyValue:'Really save empty value?',emptyValue:'- none',invalidNumber:'Value must be valid number',statusError:'ERROR! Status: %status%. Try save data later.'};this.enable=function(b,c,d){if(j.items[b]){throw new Error('Editable component with name '+b+' already exits');}$.get(mesour.core.createLink(b,'dataStructure')).complete(function(r){try{var a=$.parseJSON(r.responseText).data;j.items[b]=new mesour._editable.Editable(b,a,j);j.items[b].setInline(c);j.items[b].setDisabledInlineAlerts(d)}catch(e){throw e;}})};this.getTranslate=function(a){return l[a]};this.setTranslations=function(a){l=a};this.removeReference=function(a,b){if(b){delete k[a][b]}else{delete k[a]}};this.getReferenceData=function(b,c,d,f){k[b]=k[b]||{};if(!k[b][c]){var g={'table':c,'referencedTable':null};if(f){g['referencedTable']=f}var h=mesour.core.createLink(b,'referenceData',g,true);$.post(h[0],h[1]).complete(function(r){var a=$.parseJSON(r.responseText);k[b][c]=a;d(a);try{}catch(e){mesour.core.redrawCallback(r)}})}else{d(k[b][c])}};this.getComponent=function(a){if(!j.items[a]){throw new Error('Editable component with name '+a+' not exits');}return j.items[a]}};mesour.core.createWidget('editable',new m())})(jQuery);